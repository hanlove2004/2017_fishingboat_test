<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">

	<!-- 로그인 -->
	<select id="selectLogin" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT 
				USR_ID, 
				NAM, 
				USR_EMAIL, 
				REG_DAT, 
				PHONE 
			FROM 
				TB_USR_T A
			WHERE 
				A.USR_ID = #{usrid}
				AND A.PW = #{usrpw}
		]]>
	</select>
	
	<!-- 아이디 중복 확인 -->
	<select id="selectIdCheck" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT 
				COUNT(*) AS RESULT
			FROM 
				TB_USR_T A
			WHERE 
				A.USR_ID = #{usrid}
		]]>
	</select>
	
	<!-- 회원가입 -->
	<insert id="insertJoin" parameterType="hashmap">
		<![CDATA[
			INSERT INTO 
				TB_USR_T 
				(
					USR_ID, 
					PW, 
					NAM, 
					USR_EMAIL, 
					REG_DAT, 
					ISADMIN, 
					PHONE
				)
			VALUES 
				(
					#{usrid}, 
					#{usrpw}, 
					#{name}, 
					#{emailtrue}, 
					SYSDATE, 
					'N', 
					#{phonetrue}
				)
		]]>
	</insert>
	
	<!-- 회원정보 조회 -->
	<select id="selectMemberInfo" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT 
				USR_ID, 
				NAM, 
				USR_EMAIL,
				TO_CHAR(REG_DAT, 'YYYY-MM-DD') AS REG_DAT,
				PHONE,
				PW
			FROM 
				TB_USR_T A
			WHERE 
				A.USR_ID = #{usrid}
		]]>
	</select>
	
	<!-- 아이디찾기 -->
	<select id="selectUsrIdSearch" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				A.USR_ID,
				A.PW,
				A.NAM,
				A.USR_EMAIL,
				TO_CHAR(A.REG_DAT, 'yyyy-mm-dd') AS REG_DAT,
				A.ISADMIN,
				A.PHONE
			FROM 
				TB_USR_T A
			WHERE 
				A.NAM = #{nam}
				AND A.USR_EMAIL = #{email}
		]]>
	</select>
	
	<!-- 비밀번호찾기 -->
	<select id="selectUsrPwSearch" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT 
				A.USR_ID,
				A.PW,
				A.NAM,
				A.USR_EMAIL,
				TO_CHAR(A.REG_DAT, 'yyyy-mm-dd') AS REG_DAT,
				A.ISADMIN,
				A.PHONE
			FROM 
				TB_USR_T A
			WHERE 
				A.NAM = #{nam}
				AND A.USR_ID = #{usid}
				AND A.USR_EMAIL = #{email}
		]]>
	</select>
	
	<!-- 비밀번호찾기 (임시비밀번호로 정보 update) -->
	<update id="updateMemberPw" parameterType="hashmap">
		<![CDATA[
			UPDATE 
				TB_USR_T 
			SET
				PW = #{tmpr_pw}
			WHERE 
				NAM = #{nam}
				AND USR_ID = #{usid}
				AND USR_EMAIL = #{email}
		]]>
	</update>
	
</mapper>

