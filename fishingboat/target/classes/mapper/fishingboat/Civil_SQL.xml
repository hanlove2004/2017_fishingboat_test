<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="civil">

	<!-- Q&A 목록 -->
	<select id="selectQnaList" parameterType="hashmap" resultType="hashmap">
		<include refid="common.pagingPre"/>
			<![CDATA[
				SELECT
					ROW_NUMBER() OVER (ORDER BY SEQ DESC) RNUM,
					SEQ,
					TITLE,
					CONTENT,
					ISSUSE,
					TO_CHAR(REG_DAT, 'yyyy/mm/dd HH24:MI:SS') AS REG_DAT,
					HIT_CNT,
					USR_ID,
					ANSWER
				FROM 
					TB_QA_T
				WHERE
					ISSUSE = 'Y'
			]]>
		<include refid="common.pagingPost"/>
	</select>
	
	<!-- Q&A 상세보기 -->
	<select id="selectQnaDetail" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				A.SEQ,
				A.TITLE,
				A.CONTENT,
				A.ISSUSE,
				TO_CHAR(A.REG_DAT, 'YYYY-MM-DD') AS REG_DAT,
				A.HIT_CNT,
				A.USR_ID,
				A.ANSWER,
				NVL(B.NAM, '관리자') AS NAM
			FROM 
				TB_QA_T A,
				TB_USR_T B
			WHERE
				A.SEQ = #{seq}
				AND A.USR_ID = B.USR_ID(+)
		]]>
	</select>
	
	<!-- Q&A insert -->
	<insert id="insertQna" parameterType="hashmap">
		<![CDATA[
			INSERT INTO 
				TB_QA_T 
				(
					SEQ, 
					TITLE, 
					CONTENT, 
					ISSUSE, 
					REG_DAT, 
					HIT_CNT, 
					USR_ID
				)
			VALUES
				(
					(
						SELECT 
							NVL(MAX(seq),0) + 1 
						FROM
							TB_QA_T
					),
					#{title},
					#{content},
					'Y',
					SYSDATE,
					'1',
					#{usrid}
				)
		]]>
	</insert>
	
	<!-- 관련규정 및 서식 목록 -->
	<select id="selectRuleList" parameterType="hashmap" resultType="hashmap">
		<include refid="common.pagingPre"/>
			<![CDATA[
				SELECT
					ROW_NUMBER() OVER (ORDER BY A.SEQ DESC) RNUM,
					A.SEQ,
					A.TITLE,
					A.CONTENT,
					A.ISSUSE,
					TO_CHAR(A.REG_DAT, 'yyyy/mm/dd HH24:MI:SS') AS REG_DAT,
					A.HIT_CNT,
					A.USR_ID,
					B.ORG_FLE_NAM,
					B.SAV_FLE_NAM,
					B.SEQ AS FILE_SEQ
				FROM 
					TB_RULE_T A,
					(
						SELECT 
							* 
						FROM 
							TB_FILE_T 
						WHERE 
							BOARD_TYPE='ruleboard'
					) B
				WHERE 
					A.SEQ = B.BOARD_SEQ(+)
			]]>
		<include refid="common.pagingPost"/>
	</select>
	
</mapper>

